[env:esp32-p4]
platform = https://github.com/pioarduino/platform-espressif32/releases/download/stable/platform-espressif32.zip
board = esp32-p4
framework = arduino

; === FLASH & STORAGE ===
board_upload.flash_size = 16MB
board_build.partitions = default_16MB.csv
board_build.flash_mode = qio
board_build.f_flash = 80000000L         ; 80MHz flash speed (max for QIO)

; === PSRAM (32MB OPI) ===
board_build.psram_type = opi
board_build.f_psram = 200000000L        ; 200MHz PSRAM speed (OPI max)

; === CPU FREQUENCY ===
board_build.f_cpu = 360000000L          ; 360MHz dual-core RISC-V (max speed)

lib_ldf_mode = deep
lib_archive = false

extra_scripts = pre:remove_lvgl_asm.py

build_flags =
    -DBOARD_HAS_PSRAM
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DARDUINO_USB_MODE=1
    -DCORE_DEBUG_LEVEL=0
    -DLV_CONF_INCLUDE_SIMPLE
    -I.
    ; Optimization flags for RISC-V dual-core
    -O3
    -ffunction-sections
    -fdata-sections
    ; LVGL ASM disabled (RISC-V, not ARM)
    -DLV_USE_DRAW_SW_ASM=LV_DRAW_SW_ASM_NONE
    -DLV_USE_DRAW_SW_ASM_HELIUM=0
    -DLV_USE_DRAW_SW_ASM_NEON=0
    -Wno-deprecated-declarations

build_unflags =

build_src_filter =
    +<*>
    +<fonts/*.c>
    -<.git/>
    -<.svn/>

upload_speed = 921600
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

lib_deps =
    lvgl/lvgl@^9.4.0
    tamctec/TAMC_GT911@^1.0.2
    bblanchon/ArduinoJson@^7.3.0
    bitbank2/JPEGDEC@^1.6.0
    ESP32Async/ESPAsyncWebServer
    ricmoo/QRCode@^0.0.1